{"version":3,"file":"libertyware-ngx-form-builder.js","sources":["ng://@libertyware/ngx-form-builder/models/dynamic-form-group-config.ts","ng://@libertyware/ngx-form-builder/validators/forever-invalid.validator.ts","ng://@libertyware/ngx-form-builder/utils/dynamic-form-control.ts","ng://@libertyware/ngx-form-builder/utils/dynamic-form-group.ts","ng://@libertyware/ngx-form-builder/utils/dynamic-form-builder.ts","ng://@libertyware/ngx-form-builder/libertyware-ngx-form-builder.ts"],"sourcesContent":["import { AbstractControlOptions, AsyncValidatorFn, ValidatorFn } from '@angular/forms';\nimport { ValidatorOptions } from 'class-validator';\nimport { isNullOrUndefined } from 'util';\n\nexport interface DynamicFormGroupConfig {\n  validator?: ValidatorFn | undefined;\n  asyncValidator?: AsyncValidatorFn | undefined;\n  validators?: ValidatorFn[] | undefined;\n  asyncValidators?: AsyncValidatorFn[] | undefined;\n  updateOn?: any | undefined;\n  customValidatorOptions?: ValidatorOptions | undefined;\n}\nexport function isDynamicFormGroupConfig(options:DynamicFormGroupConfig) {\n  return options && !isNullOrUndefined(options['customValidatorOptions']);\n}\nexport function isLegacyOrOpts(options: DynamicFormGroupConfig) {\n  return options && (!isNullOrUndefined(options['validator']) || !isNullOrUndefined(options['asyncValidator']));\n}\nexport function isAbstractControlOptions(options: AbstractControlOptions | DynamicFormGroupConfig) {\n  return (\n    options &&\n    (!isNullOrUndefined(options.validators) ||\n      !isNullOrUndefined(options.asyncValidators) ||\n      !isNullOrUndefined(options.updateOn))\n  );\n}\n","import { FormControl } from '@angular/forms';\r\n\r\nexport function foreverInvalid(c: FormControl) {\r\n  return {\r\n    foreverInvalid: {\r\n      valid: false\r\n    }\r\n  };\r\n}\r\nexport const FOREVER_INVALID_NAME = 'foreverInvalid';\r\n","import { FormControl } from '@angular/forms';\nimport { ValidationMetadata } from 'class-validator/metadata/ValidationMetadata';\nimport { MetadataKeys, RadioOption, TextareaOption } from '@libertyware/ngx-form-core';\n\nimport { DynamicFormGroupField } from '../models/dynamic-form-group-field';\nimport { DynamicFormGroup } from './dynamic-form-group';\n\nexport class DynamicFormControl extends FormControl {\n  public validationDefinitions: ValidationMetadata[];\n\n  constructor(fieldDefinition: DynamicFormGroupField) {\n    super(fieldDefinition.data, fieldDefinition.validationFunctions);\n\n    this.validationDefinitions = fieldDefinition.validationDefinitions;\n  }\n\n  private get formModel(): any {\n    return (this.parent as DynamicFormGroup<any>).object;\n  }\n\n\n  get hint(): string {\n    return this.metaData(MetadataKeys.HINT);\n  }\n\n  get readableName(): string {\n    return this.metaData(MetadataKeys.DISPLAY_NAME) || this.ControlName;\n  }\n\n  get placeholder(): string {\n    return this.metaData(MetadataKeys.PLACEHOLDER);\n  }\n\n  private metaData(key: string): any {\n    return Reflect.getMetadata(key, this.formModel, this.ControlName);\n  }\n\n  get ControlName(): string {\n    const controls: any = this.parent.controls;\n    return Object.keys(controls).find(name => this === controls[name]) as string;\n  }\n\n  get radioOptions(): RadioOption[] {\n    return this.metaData(MetadataKeys.RADIO_OPTIONS) || [];\n  }\n\n  get textareaOptions(): TextareaOption {\n    return this.metaData(MetadataKeys.TEXTAREA_OPTIONS);\n  }\n}\n","import {\n  AbstractControl,\n  AbstractControlOptions,\n  AsyncValidatorFn,\n  FormArray,\n  FormBuilder,\n  FormControl,\n  FormGroup,\n  ValidatorFn\n} from '@angular/forms';\nimport { classToClass, plainToClass } from 'class-transformer';\nimport { ClassType } from 'class-transformer/ClassTransformer';\nimport {\n  getFromContainer,\n  MetadataStorage,\n  validate,\n  validateSync,\n  ValidationError,\n  ValidationTypes,\n  Validator,\n  ValidatorOptions\n} from 'class-validator';\nimport { ValidationMetadata } from 'class-validator/metadata/ValidationMetadata';\nimport 'reflect-metadata';\nimport { BehaviorSubject, Subject } from 'rxjs';\nimport {\n  Dictionary,\n  DynamicFormGroupField,\n  ShortValidationErrors\n} from '../models';\nimport {\n  foreverInvalid,\n  FOREVER_INVALID_NAME\n} from '../validators/forever-invalid.validator';\nimport { DynamicFormControl } from './dynamic-form-control';\nimport { WidgetOptions, getFormFieldsOptions } from '@libertyware/ngx-form-core';\n\nimport cloneDeep from 'lodash.clonedeep';\nimport mergeWith from 'lodash.mergewith';\n\n// Enforces the properties of the object, if supplied, to be of the original type or DynamicFormGroup or, FormArray\nexport type FormModel<T> = {\n  [P in keyof T]?: T[P] | DynamicFormGroup<any> | FormArray;\n};\n\nexport class DynamicFormGroup<TModel> extends FormGroup {\n  public nativeValidateErrors = new BehaviorSubject<Dictionary>({});\n  public customValidateErrors = new BehaviorSubject<ShortValidationErrors>({});\n  public formErrors: ShortValidationErrors | null = null;\n  public formFields: Dictionary;\n  public objectChange = new Subject();\n\n  protected FormControlClass = DynamicFormControl;\n  protected _object: TModel | null = null;\n  protected _externalErrors: ShortValidationErrors | null = null;\n  protected _validatorOptions: ValidatorOptions | null = null;\n  protected _fb = new FormBuilder();\n  private _formGen: WidgetOptions[];\n\n  constructor(\n    public factoryModel: ClassType<TModel>,\n    public fields: FormModel<TModel>,\n    validatorOrOpts?:\n      | ValidatorFn\n      | ValidatorFn[]\n      | AbstractControlOptions\n      | null,\n    asyncValidator?: AsyncValidatorFn | AsyncValidatorFn[] | null\n  ) {\n    super({}, validatorOrOpts, asyncValidator);\n    /*\n    const classValidators = DynamicFormGroup.getClassValidators<TModel>(\n      this.factoryModel,\n      this.fields,\n      this.defaultValidatorOptions\n    );\n    const formGroup = this._fb.group(\n      classValidators\n    );\n    Object.keys(formGroup.controls).forEach(key => {\n      this.addControl(key, formGroup.controls[key]);\n    });\n    this.valueChanges.subscribe(data => {\n      this.validate(\n        undefined,\n        this.defaultValidatorOptions\n      );\n    });*/\n    this.formFields = this.onlyFields(fields);\n    this._formGen = getFormFieldsOptions(factoryModel);\n  }\n\n  getFormGenData() {\n    return this._formGen;\n  }\n\n  // Getters & Setters\n  set externalErrors(externalErrors: ShortValidationErrors | null) {\n    this._externalErrors = externalErrors;\n    this.validate();\n  }\n  get externalErrors(): ShortValidationErrors | null {\n    return this._externalErrors;\n  }\n\n  set validatorOptions(validatorOptions: ValidatorOptions | null) {\n    this._validatorOptions = validatorOptions;\n    this.validate();\n  }\n  get validatorOptions(): ValidatorOptions | null {\n    return this._validatorOptions;\n  }\n\n  set object(object: TModel) {\n    this.setObject(object);\n  }\n  get object() {\n    return this.getObject();\n  }\n\n  // Public API\n  validate(\n    externalErrors?: ShortValidationErrors,\n    validatorOptions?: ValidatorOptions\n  ) {\n    this.validateAsync(externalErrors, validatorOptions).then(\n      () => {},\n      error => {\n        throw error;\n      }\n    );\n  }\n\n  async validateAsync(\n    externalErrors?: ShortValidationErrors,\n    validatorOptions?: ValidatorOptions\n  ) {\n    if (externalErrors === undefined) {\n      externalErrors = cloneDeep(this._externalErrors);\n    }\n\n    if (validatorOptions === undefined) {\n      validatorOptions = cloneDeep(this._validatorOptions);\n    }\n\n    if (!externalErrors) {\n      externalErrors = {};\n    }\n\n    try {\n      const result = await validate(this.object, validatorOptions);\n      const validationErrors = this.transformValidationErrors(result);\n      const allErrors = this.mergeErrors(externalErrors, validationErrors);\n\n      this.markAsInvalidForExternalErrors(externalErrors);\n      this.setCustomErrors(allErrors);\n\n      // todo: refactor, invalidate form if exists any allErrors\n      let usedForeverInvalid = false;\n      if (\n        Object.keys(allErrors).filter(key => key !== FOREVER_INVALID_NAME)\n          .length === 0 &&\n        this.get(FOREVER_INVALID_NAME)\n      ) {\n        this.removeControl(FOREVER_INVALID_NAME);\n        usedForeverInvalid = true;\n      }\n      if (\n        this.valid &&\n        Object.keys(allErrors).length > 0 &&\n        !this.get(FOREVER_INVALID_NAME)\n      ) {\n        this.addControl(\n          FOREVER_INVALID_NAME,\n          new FormControl('', [foreverInvalid as any])\n        );\n        usedForeverInvalid = true;\n      }\n      if (usedForeverInvalid) {\n        this.updateValueAndValidity({\n          onlySelf: true,\n          emitEvent: false\n        });\n      }\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  setCustomErrors(allErrors: any) {\n    this.formErrors = allErrors;\n    this.customValidateErrors.next(this.formErrors as ShortValidationErrors );\n    this.nativeValidateErrors.next(this.collectErrors(this));\n  }\n\n  protected collectErrors(control: Dictionary, isRoot = true): any | null {\n    if (control.controls) {\n      return {\n        ...(isRoot ? this.errors : {}),\n        ...Object.entries(control.controls).reduce(\n          (acc: any, [key, childControl]) => {\n            const childErrors = this.collectErrors(childControl as Dictionary<any>, false);\n            if (\n              childErrors &&\n              key !== 'foreverInvalid' &&\n              Object.keys(childErrors).length > 0\n            ) {\n              acc = {\n                ...acc,\n                [key]: {\n                  ...(acc && acc[key] ? acc[key] : {}),\n                  ...childErrors\n                }\n              };\n            }\n            return acc;\n          },\n          {}\n        )\n      };\n    } else {\n      return control.errors;\n    }\n  }\n\n  validateAllFormFields() {\n    Object.keys(this.controls).forEach(field => {\n      const control = this.get(field);\n\n      // Control\n      if (control instanceof FormControl) {\n        control.markAsTouched({ onlySelf: true });\n      }\n      // Group: recursive\n      else if (control instanceof DynamicFormGroup) {\n        control.validateAllFormFields();\n      }\n      // Array\n      else if (control instanceof FormArray) {\n        for (let i = 0; i < (control as FormArray).controls.length; i++) {\n          // Control in Array\n          if ((control as FormArray).controls[i] instanceof FormControl) {\n            ((control as FormArray).controls[i] as FormControl).markAsTouched({\n              onlySelf: true\n            });\n          }\n          // Group in Array: recursive\n          else if (\n            (control as FormArray).controls[i] instanceof DynamicFormGroup\n          ) {\n            ((control as FormArray).controls[i] as DynamicFormGroup<\n              any\n            >).validateAllFormFields();\n          }\n        }\n      }\n    });\n  }\n\n  resetValidateAllFormFields() {\n    this.markAsInvalidForExternalErrors({});\n\n    Object.keys(this.controls).forEach(field => {\n      const control = this.get(field);\n\n      // Control\n      if (control instanceof FormControl) {\n        control.setErrors(null, { emitEvent: false });\n        control.markAsUntouched({ onlySelf: true });\n        control.markAsPristine({ onlySelf: true });\n      }\n      // Group: recursive\n      else if (control instanceof DynamicFormGroup) {\n        control.resetValidateAllFormFields();\n      }\n      // Array\n      else if (control instanceof FormArray) {\n        for (let i = 0; i < (control as FormArray).controls.length; i++) {\n          // Control in Array\n          if ((control as FormArray).controls[i] instanceof FormControl) {\n            ((control as FormArray).controls[\n              i\n            ] as FormControl).setErrors(null, { emitEvent: false });\n            ((control as FormArray).controls[\n              i\n            ] as FormControl).markAsUntouched({ onlySelf: true });\n            ((control as FormArray).controls[i] as FormControl).markAsPristine({\n              onlySelf: true\n            });\n          }\n          // Group in Array: recursive\n          else if (\n            (control as FormArray).controls[i] instanceof DynamicFormGroup\n          ) {\n            ((control as FormArray).controls[i] as DynamicFormGroup<\n              any\n            >).resetValidateAllFormFields();\n          }\n        }\n      }\n    });\n    this.setCustomErrors({});\n  }\n\n  classToClass<TClassModel>(object: TClassModel) {\n    return classToClass(object, { ignoreDecorators: true });\n  }\n\n  plainToClass<TClassModel, Object>(\n    cls: ClassType<TClassModel>,\n    plain: Object\n  ) {\n    return plainToClass(cls, plain, { ignoreDecorators: true });\n  }\n\n  async setExternalErrorsAsync(externalErrors: ShortValidationErrors) {\n    this._externalErrors = externalErrors;\n    try {\n      return await this.validateAsync();\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  setExternalErrors(externalErrors: ShortValidationErrors) {\n    this.setExternalErrorsAsync(externalErrors).then(\n      () => {},\n      error => {\n        throw error;\n      }\n    );\n  }\n\n  getExternalErrors(): ShortValidationErrors {\n    return this._externalErrors as ShortValidationErrors;\n  }\n\n  clearExternalErrors() {\n    this.setExternalErrors({});\n  }\n  clearExternalErrorsAsync() {\n    return this.setExternalErrorsAsync({});\n  }\n\n  async setValidatorOptionsAsync(validatorOptions: ValidatorOptions) {\n    this._validatorOptions = validatorOptions;\n    try {\n      return await this.validateAsync();\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  setValidatorOptions(validatorOptions: ValidatorOptions) {\n    this.setValidatorOptionsAsync(validatorOptions).then(\n      () => {},\n      error => {\n        throw error;\n      }\n    );\n  }\n\n  getValidatorOptions(): ValidatorOptions {\n    return this._validatorOptions as ValidatorOptions;\n  }\n\n  // Helpers\n  protected onlyFields(fields: FormModel<any>): Dictionary {\n    const newFields: Dictionary = {};\n\n    if (fields !== undefined) {\n      Object.keys(fields).forEach(key => {\n        if (fields[key] instanceof DynamicFormGroup) {\n          // Group: recursive\n          newFields[key] = this.onlyFields(\n            (fields[key] as DynamicFormGroup<any>).formFields\n          );\n        } else {\n          // Array\n          if (fields[key] instanceof FormArray) {\n            if (\n              (fields[key] as FormArray).controls[0] instanceof DynamicFormGroup\n            ) {\n              // Group within Array: recursive\n              newFields[key] = this.onlyFields(\n                ((fields[key] as FormArray).controls[0] as DynamicFormGroup<\n                  any\n                >).formFields\n              );\n            } else {\n              // Control within Array\n              newFields[key] = (fields[key] as FormArray).controls[0].value;\n            }\n          } else {\n            // Handle Control\n            newFields[key] = fields[key];\n          }\n        }\n      });\n    }\n\n    return newFields;\n  }\n\n  transformValidationErrors(errors: ValidationError[]): ShortValidationErrors {\n    const customErrors: ShortValidationErrors = {};\n\n    errors.forEach((error: ValidationError) => {\n      if (error && error.constraints !== undefined) {\n        Object.keys(error.constraints).forEach((key: string) => {\n          if (!customErrors[error.property]) {\n            customErrors[error.property] = [];\n          }\n\n          if (\n            (customErrors[error.property] as string[]).indexOf(\n              error.constraints[key]\n            ) === -1\n          ) {\n            (customErrors[error.property] as string[]).push(\n              error.constraints[key]\n            );\n          }\n        });\n      }\n\n      if (error.children !== undefined && error.children.length) {\n        customErrors[error.property] = this.transformValidationErrors(\n          error.children\n        );\n      }\n    });\n\n    return customErrors;\n  }\n\n  protected mergeErrors(\n    externalErrors?: ShortValidationErrors,\n    validationErrors?: ShortValidationErrors\n  ) {\n    const clonedExternalErrors = cloneDeep(externalErrors);\n    return mergeWith(\n      clonedExternalErrors,\n      validationErrors,\n      (objValue, srcValue) => {\n        if (canMerge()) {\n          return objValue.concat(srcValue);\n        }\n\n        function canMerge() {\n          return (\n            Array.isArray(objValue) &&\n            Array.isArray(srcValue) &&\n            objValue.filter(objItem => srcValue.indexOf(objItem) !== -1)\n              .length === 0\n          );\n        }\n      }\n    );\n  }\n\n  protected markAsInvalidForExternalErrors(\n    errors: ShortValidationErrors,\n    controls?: Dictionary<AbstractControl>\n  ) {\n    if (!controls) {\n      controls = this.controls;\n    }\n    Object.keys(controls).forEach(field => {\n      const control = controls![field];\n\n      // Control\n      if (control instanceof FormControl) {\n        if (errors && errors[field]) {\n          control.setErrors({ externalError: true });\n        } else {\n          if (control.errors && control.errors.externalError === true) {\n            control.setErrors(null);\n          }\n        }\n      }\n      // Group\n      else if (control instanceof DynamicFormGroup) {\n        control.markAsInvalidForExternalErrors(\n          errors && errors[field]\n            ? (errors[field] as ShortValidationErrors)\n            : {}\n        );\n      }\n      // Array\n      else if (control instanceof FormArray) {\n        for (let i = 0; i < (control as FormArray).length; i++) {\n          // Control in Array\n          if (control[i] instanceof FormControl) {\n            if (errors && errors[i] && errors[i][field]) {\n              control[i].setErrors({ externalError: true });\n            } else if (\n              control[i].errors &&\n              control[i].errors.externalError === true\n            ) {\n              control[i].setErrors(null);\n            }\n          }\n          // Group in Array\n          else if (control[i] instanceof DynamicFormGroup) {\n            control[i].markAsInvalidForExternalErrors(\n              errors && errors[i] && errors[i][field]\n                ? (errors[i][field] as ShortValidationErrors)\n                : {}\n            );\n          }\n        }\n      }\n    });\n  }\n\n  /**\n   * Recursively gets all values from the form controls and all sub form group and array controls and returns it as\n   * an object\n   */\n  protected getObject(): TModel {\n    // Initialize the shape of the response\n    const object = this._object\n      ? this.classToClass(this._object)\n      : this.factoryModel\n      ? new this.factoryModel()\n      : undefined;\n\n    if (object !== undefined) {\n      // Recursively get the value of all fields\n      Object.keys(this.controls)\n        .filter(name => name !== FOREVER_INVALID_NAME)\n        .forEach(key => {\n          // Handle Group\n          if (this.controls[key] instanceof DynamicFormGroup) {\n            object[key] = (this.controls[key] as DynamicFormGroup<any>).object;\n          }\n\n          // Handle Form Array\n          else if (this.controls[key] instanceof FormArray) {\n            // Initialize value\n            object[key] = [];\n\n            for (\n              let i = 0;\n              i < (this.controls[key] as FormArray).controls.length;\n              i++\n            ) {\n              let value;\n\n              if (\n                (this.controls[key] as FormArray).controls[i] instanceof\n                DynamicFormGroup\n              ) {\n                // Recursively get object group\n                value = ((this.controls[key] as FormArray).controls[\n                  i\n                ] as DynamicFormGroup<any>).object;\n              } else {\n                value = (this.controls[key] as FormArray).controls[i].value;\n              }\n              if (value && Object.keys(value).length > 0) {\n                object[key].push(value);\n              }\n            }\n          }\n\n          // Handle Control\n          else {\n            object[key] = this.controls[key].value;\n          }\n        });\n    }\n    return (this.factoryModel\n      ? this.plainToClass(this.factoryModel, object)\n      : object) as TModel;\n  }\n\n  /**\n   * Sets the value of every control on the form and recursively sets the values of the controls\n   * on all sub form groups\n   *\n   * @param object the data to assign to all controls of the form group and sub groups\n   */\n  protected setObject(object: TModel) {\n    if (object instanceof this.factoryModel) {\n      this._object = this.classToClass(object); // Ensure correct type\n    } else {\n      this._object = this.plainToClass(this.factoryModel, object as Object); // Convert to Model type\n    }\n\n    // Recursively set the value of all fields\n    Object.keys(this.controls).forEach(key => {\n      // Handle Group\n      if (this.controls[key] instanceof DynamicFormGroup) {\n        (this.controls[key] as DynamicFormGroup<any>).object = this._object\n          ? this._object[key]\n          : {};\n      }\n\n      // Handle FormArray\n      else if (this.controls[key] instanceof FormArray) {\n        const objectArray = this._object ? this._object[key] : [];\n        const formArray = this.controls[key] as FormArray;\n        const isFormGroup = formArray.controls[0] instanceof DynamicFormGroup;\n        const firstFormGroup = formArray.controls[0] as DynamicFormGroup<any>;\n        const formControl = formArray.controls[0] as FormControl;\n\n        // Clear FormArray while retaining the reference\n        while (formArray.length !== 0) {\n          formArray.removeAt(0);\n        }\n\n        for (let i = 0; i < objectArray.length; i++) {\n          if (isFormGroup) {\n            // Create FormGroup\n            const dynamicFormGroup = new DynamicFormGroup(\n              firstFormGroup.factoryModel,\n              firstFormGroup.formFields\n            );\n\n            dynamicFormGroup.setParent(this);\n\n            const classValidators = getClassValidators<TModel>(\n              firstFormGroup.factoryModel,\n              firstFormGroup.formFields,\n              undefined,\n              this.FormControlClass\n            );\n            const formGroup = this._fb.group(classValidators);\n\n            // Add all controls to the form group\n            Object.keys(formGroup.controls).forEach(ctrlKey => {\n              dynamicFormGroup.addControl(ctrlKey, formGroup.controls[ctrlKey]);\n            });\n\n            // Add a value change listener to the group. on change, validate\n            dynamicFormGroup.valueChanges.subscribe(data => {\n              dynamicFormGroup.validate(undefined, this._validatorOptions as ValidatorOptions);\n            });\n\n            formArray.controls.push(dynamicFormGroup);\n\n            // Recusrively set the object value\n            (formArray.controls[i] as DynamicFormGroup<any>).object =\n              this._object && objectArray && objectArray[i]\n                ? objectArray[i]\n                : {};\n          } else {\n            // Create control\n            const controlValue =\n              this._object && objectArray && objectArray[i]\n                ? objectArray[i]\n                : undefined;\n            const newFormControl = new FormControl(\n              controlValue,\n              formControl.validator\n            );\n            newFormControl.setParent(this);\n\n            // Add the control to the FormArray\n            formArray.controls.push(newFormControl);\n          }\n        }\n      }\n\n      // Handle Control\n      else {\n        const newObject = this._object ? this._object[key] : [];\n        this.controls[key].setValue(\n          this._object && newObject ? newObject : undefined\n        );\n      }\n    });\n    this.objectChange.next(this._object);\n  }\n}\n\nexport function getClassValidators<TModel>(\n  factoryModel: ClassType<TModel>,\n  fields: Dictionary,\n  validatorOptions?: ValidatorOptions,\n  FormControlClass: any = DynamicFormControl\n) {\n  // Get the validation rules from the object decorators\n  const allValidationMetadatas: ValidationMetadata[] = getFromContainer(\n    MetadataStorage\n  ).getTargetValidationMetadatas(factoryModel, '');\n\n  // Get the validation rules for the validation group: https://github.com/typestack/class-validator#validation-groups\n  const validationGroupMetadatas: ValidationMetadata[] = getFromContainer(\n    MetadataStorage\n  ).getTargetValidationMetadatas(\n    factoryModel,\n    '',\n    validatorOptions && validatorOptions.groups\n      ? validatorOptions.groups\n      : undefined\n  );\n\n  const formGroupFields = {};\n  const validator = new Validator();\n\n  // Loop through all fields in the form definition\n  Object.keys(fields)\n    .filter(key => key.indexOf('__') !== 0)\n    .forEach(fieldName => {\n      // Conditional Validation for the field\n      const conditionalValidations: ValidationMetadata[] = [];\n      validationGroupMetadatas.forEach(validationMetadata => {\n        if (\n          isPropertyValidatorOfType(\n            validationMetadata,\n            fieldName,\n            ValidationKeys.conditional.type\n          )\n        ) {\n          conditionalValidations.push(validationMetadata);\n        }\n      });\n\n      // All Nested Validation for the field\n      const allNestedValidations: ValidationMetadata[] = [];\n      allValidationMetadatas.forEach(validationMetadata => {\n        if (\n          isPropertyValidatorOfType(\n            validationMetadata,\n            fieldName,\n            ValidationKeys.nested.type\n          )\n        ) {\n          allNestedValidations.push(validationMetadata);\n        }\n      });\n\n      // Nested Validation for the field for the requested class-validator group\n      const nestedGroupValidations: ValidationMetadata[] = [];\n      validationGroupMetadatas.forEach(validationMetadata => {\n        if (\n          isPropertyValidatorOfType(\n            validationMetadata,\n            fieldName,\n            ValidationKeys.nested.type\n          )\n        ) {\n          nestedGroupValidations.push(validationMetadata);\n        }\n      });\n\n      const fieldDefinition: DynamicFormGroupField = {\n        data: formGroupFields[fieldName],\n        validationFunctions: [],\n        validationDefinitions: []\n      };\n\n      if (fieldDefinition.data === undefined) {\n        fieldDefinition.data = fields[fieldName];\n      }\n      // TRY LINK EXISTS NATIVE VALIDATIONS, UNSTABLE !!!\n      if (\n        Array.isArray(fieldDefinition.data) &&\n        fieldDefinition.data.length > 1 &&\n        fieldDefinition.data.filter(\n          (validationFunction, index) =>\n            index > 0 && typeof validationFunction === 'function'\n        ).length > 0\n      ) {\n        fieldDefinition.data\n          .filter(\n            (validationFunction, index) =>\n              index > 0 && typeof validationFunction === 'function'\n          )\n          .forEach(validationFunction =>\n            fieldDefinition.validationFunctions.push(validationFunction)\n          );\n        fieldDefinition.data = fieldDefinition.data[0];\n      }\n\n      validationGroupMetadatas.forEach(validationMetadata => {\n        if (\n          validationMetadata.propertyName === fieldName &&\n          validationMetadata.type !== ValidationKeys.conditional.type\n        ) {\n          // Add all validation to the field except the @NestedValidation definition as\n          // being part of the form would imply it is validated if any other rules are present\n          if (validationMetadata.type !== ValidationKeys.nested.type) {\n            fieldDefinition.validationDefinitions.push(validationMetadata);\n          }\n\n          for (const typeKey in ValidationTypes) {\n            if (ValidationTypes.hasOwnProperty(typeKey)) {\n              // Handle Nested Validation\n              if (\n                checkWithAllNestedValidations(\n                  allNestedValidations,\n                  nestedGroupValidations,\n                  fieldName\n                )\n              ) {\n                if (isNestedValidate(validationMetadata, typeKey)) {\n                  const objectToValidate =\n                    fields[fieldName] instanceof DynamicFormGroup\n                      ? fields[fieldName].object\n                      : undefined;\n                  const nestedValidate = createNestedValidate(\n                    objectToValidate,\n                    validationMetadata\n                  );\n                  setFieldData(fieldName, fieldDefinition, nestedValidate);\n                }\n              }\n\n              // Handle Custom Validation\n              if (isCustomValidate(validationMetadata, typeKey)) {\n                const customValidation = createCustomValidation(\n                  fieldName,\n                  validationMetadata\n                );\n                setFieldData(fieldName, fieldDefinition, customValidation);\n              }\n\n              // Handle remaining validation\n              if (isDynamicValidate(validationMetadata, typeKey)) {\n                const dynamicValidate = createDynamicValidate(\n                  validationMetadata,\n                  conditionalValidations,\n                  fieldName\n                );\n                setFieldData(fieldName, fieldDefinition, dynamicValidate);\n              }\n            }\n          }\n        }\n      });\n      // Convert to a structure, angular understands\n      if (\n        fieldDefinition.data instanceof DynamicFormGroup ||\n        fieldDefinition.data instanceof FormArray\n      ) {\n        formGroupFields[fieldName] = fieldDefinition.data;\n      } else {\n        formGroupFields[fieldName] = new FormControlClass(fieldDefinition);\n      }\n    });\n\n  return formGroupFields;\n\n  // ******************************************************************************************\n  // Local Helper functions to help make the main code more readable\n  //\n\n  function createNestedValidate(\n    objectToValidate: any,\n    validationMetadata: ValidationMetadata\n  ) {\n    return function(control: FormControl) {\n      const isValid =\n        getValidateErrors(\n          control,\n          objectToValidate !== undefined ? objectToValidate : control.value,\n          validatorOptions as ValidatorOptions\n        ).length === 0;\n      return getIsValidResult(isValid, validationMetadata, 'nestedValidate');\n    };\n  }\n\n  function createDynamicValidate(\n    validationMetadata: ValidationMetadata,\n    conditionalValidations: ValidationMetadata[],\n    fieldName: string\n  ) {\n    return function(control: FormControl) {\n      if (!control) {\n        return null;\n      }\n\n      let isValid =\n        control.parent && control.parent.value\n          ? validator.validateValueByMetadata(control.value, validationMetadata)\n          : true;\n\n      if (!isValid && conditionalValidations.length > 0) {\n        const validateErrors = setObjectValueAndGetValidationErrors(\n          control,\n          fieldName,\n          validatorOptions as ValidatorOptions\n        );\n        isValid =\n          validateErrors.filter(\n            (error: ValidationError) => error.property === fieldName\n          ).length === 0;\n      }\n\n      return getIsValidResult(isValid, validationMetadata, 'dynamicValidate');\n    };\n  }\n\n  function createCustomValidation(\n    fieldName: string,\n    validationMetadata: ValidationMetadata\n  ) {\n    return function(control: FormControl) {\n      const validateErrors: ValidationError[] = setObjectValueAndGetValidationErrors(\n        control,\n        fieldName,\n        validatorOptions as ValidatorOptions\n      );\n      const isValid = getAllErrors(validateErrors, fieldName).length === 0;\n      return getIsValidResult(isValid, validationMetadata, 'customValidation');\n    };\n  }\n\n  function checkWithAllNestedValidations(\n    allNestedValidations: ValidationMetadata[],\n    nestedValidations: ValidationMetadata[],\n    key: string\n  ) {\n    return (\n      allNestedValidations.length === nestedValidations.length ||\n      ((fields[key] instanceof DynamicFormGroup ||\n        fields[key] instanceof FormArray) &&\n        allNestedValidations.length > 0 && nestedValidations.length === 0)\n    );\n  }\n\n  function isDynamicValidate(\n    validationMetadata: ValidationMetadata,\n    typeKey: string\n  ) {\n    return (\n      validationMetadata.type === ValidationTypes[typeKey] &&\n      validator[validationMetadata.type] !== undefined\n    );\n  }\n\n  /**\n   * marked with @Validate(...)\n   * https://github.com/typestack/class-validator#custom-validation-classes\n   */\n  function isCustomValidate(\n    validationMetadata: ValidationMetadata,\n    typeKey: string\n  ) {\n    return (\n      isNotPropertyValidation(validationMetadata, typeKey) &&\n      validationMetadata.type === ValidationKeys.custom.type &&\n      typeKey === ValidationKeys.custom.typeKey\n    );\n  }\n\n  /**\n   * marked with @ValidateNested()\n   * https://github.com/typestack/class-validator#validating-nested-objects\n   */\n  function isNestedValidate(\n    validationMetadata: ValidationMetadata,\n    typeKey: string\n  ) {\n    return (\n      isNotPropertyValidation(validationMetadata, typeKey) &&\n      validationMetadata.type === ValidationKeys.nested.type &&\n      typeKey === ValidationKeys.nested.typeKey\n    );\n  }\n\n  function isNotPropertyValidation(\n    validationMetadata: ValidationMetadata,\n    typeKey: string\n  ) {\n    return (\n      validationMetadata.type === ValidationTypes[typeKey] &&\n      validator[validationMetadata.type] === undefined\n    );\n  }\n\n  function setFieldData(\n    fieldName: string,\n    fieldDefinition: DynamicFormGroupField,\n    validationFunction: Function\n  ) {\n    /* todo: maybe not need, if enable this code, experemental mode not work\n    if (fields[fieldName] instanceof DynamicFormGroup) {\n      fields[fieldName].object = fields[fieldName].fields;\n    }*/\n\n    // Fill field data if empty\n    if (fieldDefinition.data === undefined) {\n      fieldDefinition.data = fields[fieldName];\n    }\n\n    fieldDefinition.validationFunctions.push(validationFunction);\n  }\n\n  function getAllErrors(\n    validateErrors: ValidationError[],\n    fieldName: string\n  ): ValidationError[] {\n    return validateErrors.filter(\n      (error: ValidationError) =>\n        // Check for nested/child errors\n        (error.children.length &&\n          error.children.filter(children => children.property === fieldName)) ||\n        error.property === fieldName\n    );\n  }\n}\n\n// ***************************************************************\n// Global Helper functions\n//\n\nfunction isPropertyValidatorOfType(\n  validationMetadata: ValidationMetadata,\n  fieldName: string,\n  validationMetadataType: string\n) {\n  return (\n    validationMetadata.propertyName === fieldName &&\n    validationMetadata.type === validationMetadataType\n  );\n}\n\nfunction setObjectValueAndGetValidationErrors(\n  control: FormControl,\n  key: string,\n  validatorOptions: ValidatorOptions\n) {\n  const object =\n    control.parent instanceof DynamicFormGroup\n      ? (control.parent as DynamicFormGroup<any>).object\n      : control.parent\n      ? control.parent.value\n      : {};\n\n  if (object) {\n    object[key] = control.value;\n  }\n\n  return getValidateErrors(control, object, validatorOptions);\n}\n\nfunction getValidateErrors(\n  control: FormControl,\n  dataToValidate: any,\n  validatorOptions: ValidatorOptions\n) {\n  const validateErrors: ValidationError[] =\n    control.parent && control.parent.value\n      ? validateSync(dataToValidate, validatorOptions)\n      : [];\n  return validateErrors;\n}\n\nfunction getIsValidResult(\n  isValid: boolean,\n  validationMetadata: ValidationMetadata,\n  errorType: ErrorPropertyName\n) {\n  return isValid\n    ? null\n    : {\n        [errorType]: {\n          valid: false,\n          type: validationMetadata.type\n        }\n      };\n}\n\ntype ErrorPropertyName =\n  | 'nestedValidate'\n  | 'customValidation'\n  | 'dynamicValidate';\n\nconst ValidationKeys = {\n  nested: {\n    type: 'nestedValidation',\n    typeKey: 'NESTED_VALIDATION'\n  },\n  conditional: {\n    type: 'conditionalValidation'\n  },\n  custom: {\n    type: 'customValidation',\n    typeKey: 'CUSTOM_VALIDATION'\n  }\n};\n","import 'reflect-metadata';\n\nimport { AbstractControlOptions, AsyncValidatorFn, FormBuilder, ValidatorFn } from '@angular/forms';\nimport { plainToClass } from 'class-transformer';\nimport { ClassType } from 'class-transformer/ClassTransformer';\n\nimport {\n  DynamicFormGroupConfig,\n  isAbstractControlOptions,\n  isDynamicFormGroupConfig,\n  isLegacyOrOpts\n} from '../models/dynamic-form-group-config';\nimport { DynamicFormGroup, FormModel, getClassValidators } from './dynamic-form-group';\nimport { DynamicFormControl } from './dynamic-form-control';\nimport { DynamicForm } from '@libertyware/ngx-form-core';\n\nexport class DynamicFormBuilder extends FormBuilder {\n\n  protected FormGroupClass = DynamicFormGroup;\n  protected FormControlClass = DynamicFormControl;\n  group<TModel>(\n    factoryModel: ClassType<TModel>,\n    controlsConfig?:\n      | FormModel<TModel>\n      | DynamicFormGroupConfig\n      | { [key: string]: any },\n    options?: AbstractControlOptions | DynamicFormGroupConfig\n  ): DynamicFormGroup<TModel> {\n    // Process the group with the controlsConfig passed into extra instead. (What does this accomplish?)\n    if (\n      controlsConfig &&\n      (isAbstractControlOptions(controlsConfig) ||\n        isLegacyOrOpts(controlsConfig) ||\n        isDynamicFormGroupConfig(controlsConfig)) &&\n      !options\n    ) {\n      return this.group(factoryModel, undefined, controlsConfig);\n    }\n\n    // This section of code was added in from the original code - Jordan\n    if (!controlsConfig) {\n      const model = (new factoryModel() as unknown) as DynamicForm;\n      const fields = model.getFormFields();\n      controlsConfig = {\n        ...((fields\n          .map((field: any) => ({\n            [field.fieldName]: ''\n          }))\n          .reduce(\n            (rev: any, current: any) => ({ ...rev, ...current }),\n            {}\n          ) as unknown) as FormModel<TModel>)\n      };\n    }\n\n    const extra: DynamicFormGroupConfig = options as DynamicFormGroupConfig;\n\n    let validators: ValidatorFn[] | null = null;\n    let asyncValidators: ValidatorFn[]  | null = null;\n    let updateOn: any;\n\n    if (extra != null) {\n      if (isAbstractControlOptions(extra)) {\n        // `extra` are `AbstractControlOptions`\n        validators = extra.validators != null ? extra.validators : null;\n        asyncValidators = extra.asyncValidators != null ? extra.asyncValidators : null;\n        updateOn = extra.updateOn != null ? extra.updateOn : undefined;\n      }\n      if (isLegacyOrOpts(extra)) {\n        // `extra` are legacy form group options\n        validators = validators || [];\n        if (extra.validator) validators.push(extra.validator);\n\n        asyncValidators = asyncValidators || [];\n        if (extra.asyncValidator) validators.push(extra.asyncValidator);\n      }\n      // Set default customValidatorOptions\n      if (!isDynamicFormGroupConfig(extra)) {\n        extra.customValidatorOptions = { validationError: { target: false } };\n      }\n    }\n\n    let newControlsConfig: FormModel<TModel> | any;\n\n    if (controlsConfig !== undefined) {\n      newControlsConfig = controlsConfig as FormModel<TModel>;\n    }\n\n    // experimental\n    if (controlsConfig === undefined) {\n      newControlsConfig = { ...this.createEmptyObject(factoryModel) };\n\n      Object.keys(newControlsConfig).forEach(key => {\n        if (canCreateGroup()) {\n          // recursively create a dynamic group for the nested object\n          newControlsConfig[key] = this.group(\n            newControlsConfig[key].constructor,\n            undefined,\n            {\n              ...(extra.customValidatorOptions\n                ? { customValidatorOptions: extra.customValidatorOptions }\n                : {}),\n              asyncValidators,\n              updateOn,\n              validators\n            } as any\n          );\n        } else {\n          if (canCreateArray()) {\n            if (newControlsConfig[key][0].constructor) {\n              // recursively create an array with a group\n              newControlsConfig[key] = super.array(\n                newControlsConfig[key].map((newControlsConfigItem: any) =>\n                  this.group(newControlsConfigItem.constructor, undefined, {\n                    ...(extra.customValidatorOptions\n                      ? { customValidatorOptions: extra.customValidatorOptions }\n                      : {}),\n                    asyncValidators,\n                    updateOn,\n                    validators\n                  } as any)\n                )\n              );\n            } else {\n              // Create an array of form controls\n              newControlsConfig[key] = super.array(\n                newControlsConfig[key].map((newControlsConfigItem: any) =>\n                  this.control(newControlsConfigItem)\n                )\n              );\n            }\n          }\n        }\n\n        function canCreateGroup() {\n          const candidate = newControlsConfig[key];\n\n          return (\n            candidate &&\n            !Array.isArray(candidate) &&\n            candidate.constructor &&\n            typeof candidate === 'object' &&\n            (candidate.length === undefined ||\n              (candidate.length !== undefined &&\n                Object.keys(candidate).length === candidate.length))\n          );\n        }\n\n        function canCreateArray() {\n          if (Array.isArray(newControlsConfig[key]) === false) {\n            return false;\n          }\n\n          const candidate = newControlsConfig[key][0];\n\n          return (\n            candidate.constructor &&\n            typeof candidate === 'object' &&\n            (candidate.length === undefined ||\n              (candidate.length !== undefined &&\n                Object.keys(candidate).length === candidate.length))\n          );\n        }\n      });\n    }\n\n    // Remove empty\n    validators = validators && validators.filter(validator => validator);\n    asyncValidators =\n      asyncValidators && asyncValidators.filter(validator => validator);\n\n    // Create an Angular group from the top-level object\n    const classValidators = getClassValidators<TModel>(\n      factoryModel,\n      newControlsConfig,\n      extra && extra.customValidatorOptions,\n      this.FormControlClass\n    );\n    const formGroup = super.group(classValidators, {\n      ...(asyncValidators || {}),\n      ...(updateOn || {}),\n      ...(validators || {})\n    });\n\n    // Initialize the resulting group\n    // Changed from internal FormGroup to DynamicFormGroup\n    const dynamicFormGroup = new DynamicFormGroup<TModel>(\n      factoryModel,\n      newControlsConfig,\n      {\n        asyncValidators,\n        updateOn,\n        validators\n      } as any\n    );\n\n    // Add all angular controls to the resulting dynamic group\n    Object.keys(formGroup.controls).forEach(key => {\n      dynamicFormGroup.addControl(key, formGroup.controls[key]);\n    });\n\n    // Add a listener to the dynamic group for value changes; on change, execute validation\n    dynamicFormGroup.valueChanges.subscribe(() => dynamicFormGroup.validate(undefined, extra && extra.customValidatorOptions));\n\n    return dynamicFormGroup;\n  }\n\n  // *******************\n  // Helpers\n\n  /**\n   * Recursively creates an empty object from the data provided\n   */\n  private createEmptyObject<TModel>(\n    factoryModel: ClassType<TModel>,\n    data: {[key: string]: any} = {}\n  ): any {\n    let modified = false;\n\n    const object: any = factoryModel ? plainToClass(factoryModel, data) : data;\n    const fields = Object.keys(object);\n\n    fields.forEach((fieldName: any) => {\n      if (object[fieldName] && object[fieldName].length !== undefined) {\n        if (\n          object[fieldName].length === 1 &&\n          Object.keys(object[fieldName][0]).length > 0 &&\n          object[fieldName][0].constructor\n        ) {\n          object[fieldName] = [\n            this.createEmptyObject(object[fieldName][0].constructor)\n          ];\n        }\n\n        if (object[fieldName].length === 0) {\n          data[fieldName] = [{}];\n          modified = true;\n        }\n      } else {\n        data[fieldName] = undefined;\n      }\n    });\n\n    if (modified) {\n      return this.createEmptyObject(factoryModel, data);\n    }\n\n    return object;\n  }\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":["tslib_1.__extends","tslib_1.__assign"],"mappings":"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"}