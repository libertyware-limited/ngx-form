!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("util"),require("@angular/forms"),require("class-transformer"),require("class-validator"),require("rxjs"),require("@libertyware/ngx-form-core"),require("lodash.clonedeep"),require("lodash.mergewith")):"function"==typeof define&&define.amd?define("@libertyware/ngx-form-builder",["exports","util","@angular/forms","class-transformer","class-validator","rxjs","@libertyware/ngx-form-core","lodash.clonedeep","lodash.mergewith"],r):r(((t=t||self).libertyware=t.libertyware||{},t.libertyware["ngx-form-builder"]={}),t.util,t.ng.forms,t.classTransformer,t.classValidator,t.rxjs,t.ngxFormCore,t.cloneDeep,t.mergeWith)}(this,(function(t,r,e,o,n,a,i,s,l){"use strict";s=s&&s.hasOwnProperty("default")?s.default:s,l=l&&l.hasOwnProperty("default")?l.default:l;
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */
var c=function(t,r){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])})(t,r)};function u(t,r){function e(){this.constructor=t}c(t,r),t.prototype=null===r?Object.create(r):(e.prototype=r.prototype,new e)}var f=function(){return(f=Object.assign||function(t){for(var r,e=1,o=arguments.length;e<o;e++)for(var n in r=arguments[e])Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n]);return t}).apply(this,arguments)};function d(t,r,e,o){return new(e||(e=Promise))((function(n,a){function i(t){try{l(o.next(t))}catch(t){a(t)}}function s(t){try{l(o.throw(t))}catch(t){a(t)}}function l(t){t.done?n(t.value):new e((function(r){r(t.value)})).then(i,s)}l((o=o.apply(t,r||[])).next())}))}function p(t,r){var e,o,n,a,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(e)throw new TypeError("Generator is already executing.");for(;i;)try{if(e=1,o&&(n=2&a[0]?o.return:a[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,a[1])).done)return n;switch(o=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,o=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(n=(n=i.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){i.label=a[1];break}if(6===a[0]&&i.label<n[1]){i.label=n[1],n=a;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(a);break}n[2]&&i.ops.pop(),i.trys.pop();continue}a=r.call(t,i)}catch(t){a=[6,t],o=0}finally{e=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function y(t,r){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var o,n,a=e.call(t),i=[];try{for(;(void 0===r||r-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(t){n={error:t}}finally{try{o&&!o.done&&(e=a.return)&&e.call(a)}finally{if(n)throw n.error}}return i}function h(t){return t&&!r.isNullOrUndefined(t.customValidatorOptions)}function v(t){return t&&(!r.isNullOrUndefined(t.validator)||!r.isNullOrUndefined(t.asyncValidator))}function m(t){return t&&(!r.isNullOrUndefined(t.validators)||!r.isNullOrUndefined(t.asyncValidators)||!r.isNullOrUndefined(t.updateOn))}function b(t){return{foreverInvalid:{valid:!1}}}var g=function(t){function r(r){var e=t.call(this,r.data,r.validationFunctions)||this;return e.validationDefinitions=r.validationDefinitions,e}return u(r,t),Object.defineProperty(r.prototype,"formModel",{get:function(){return this.parent.object},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"hint",{get:function(){return this.metaData(i.MetadataKeys.HINT)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"readableName",{get:function(){return this.metaData(i.MetadataKeys.DISPLAY_NAME)||this.ControlName},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"placeholder",{get:function(){return this.metaData(i.MetadataKeys.PLACEHOLDER)},enumerable:!0,configurable:!0}),r.prototype.metaData=function(t){return Reflect.getMetadata(t,this.formModel,this.ControlName)},Object.defineProperty(r.prototype,"ControlName",{get:function(){var t=this,r=this.parent.controls;return Object.keys(r).find((function(e){return t===r[e]}))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"radioOptions",{get:function(){return this.metaData(i.MetadataKeys.RADIO_OPTIONS)||[]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"textareaOptions",{get:function(){return this.metaData(i.MetadataKeys.TEXTAREA_OPTIONS)},enumerable:!0,configurable:!0}),r}(e.FormControl),O=function(t){function r(r,o,n,s){var l=t.call(this,{},n,s)||this;return l.factoryModel=r,l.fields=o,l.nativeValidateErrors=new a.BehaviorSubject({}),l.customValidateErrors=new a.BehaviorSubject({}),l.formErrors=null,l.objectChange=new a.Subject,l.FormControlClass=g,l._object=null,l._externalErrors=null,l._validatorOptions=null,l._fb=new e.FormBuilder,l.formFields=l.onlyFields(o),l._formGen=i.getFormFieldsOptions(r),l}return u(r,t),r.prototype.getFormGenData=function(){return this._formGen},Object.defineProperty(r.prototype,"externalErrors",{get:function(){return this._externalErrors},set:function(t){this._externalErrors=t,this.validate()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"validatorOptions",{get:function(){return this._validatorOptions},set:function(t){this._validatorOptions=t,this.validate()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"object",{get:function(){return this.getObject()},set:function(t){this.setObject(t)},enumerable:!0,configurable:!0}),r.prototype.validate=function(t,r){this.validateAsync(t,r).then((function(){}),(function(t){throw t}))},r.prototype.validateAsync=function(t,r){return d(this,void 0,void 0,(function(){var o,a,i,l;return p(this,(function(c){switch(c.label){case 0:void 0===t&&(t=s(this._externalErrors)),void 0===r&&(r=s(this._validatorOptions)),t||(t={}),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,n.validate(this.object,r)];case 2:return o=c.sent(),a=this.transformValidationErrors(o),i=this.mergeErrors(t,a),this.markAsInvalidForExternalErrors(t),this.setCustomErrors(i),l=!1,0===Object.keys(i).filter((function(t){return"foreverInvalid"!==t})).length&&this.get("foreverInvalid")&&(this.removeControl("foreverInvalid"),l=!0),this.valid&&Object.keys(i).length>0&&!this.get("foreverInvalid")&&(this.addControl("foreverInvalid",new e.FormControl("",[b])),l=!0),l&&this.updateValueAndValidity({onlySelf:!0,emitEvent:!1}),[3,4];case 3:throw c.sent();case 4:return[2]}}))}))},r.prototype.setCustomErrors=function(t){this.formErrors=t,this.customValidateErrors.next(this.formErrors),this.nativeValidateErrors.next(this.collectErrors(this))},r.prototype.collectErrors=function(t,r){var e=this;return void 0===r&&(r=!0),t.controls?f({},r?this.errors:{},Object.entries(t.controls).reduce((function(t,r){var o,n=y(r,2),a=n[0],i=n[1],s=e.collectErrors(i,!1);return s&&"foreverInvalid"!==a&&Object.keys(s).length>0&&(t=f({},t,((o={})[a]=f({},t&&t[a]?t[a]:{},s),o))),t}),{})):t.errors},r.prototype.validateAllFormFields=function(){var t=this;Object.keys(this.controls).forEach((function(o){var n=t.get(o);if(n instanceof e.FormControl)n.markAsTouched({onlySelf:!0});else if(n instanceof r)n.validateAllFormFields();else if(n instanceof e.FormArray)for(var a=0;a<n.controls.length;a++)n.controls[a]instanceof e.FormControl?n.controls[a].markAsTouched({onlySelf:!0}):n.controls[a]instanceof r&&n.controls[a].validateAllFormFields()}))},r.prototype.resetValidateAllFormFields=function(){var t=this;this.markAsInvalidForExternalErrors({}),Object.keys(this.controls).forEach((function(o){var n=t.get(o);if(n instanceof e.FormControl)n.setErrors(null,{emitEvent:!1}),n.markAsUntouched({onlySelf:!0}),n.markAsPristine({onlySelf:!0});else if(n instanceof r)n.resetValidateAllFormFields();else if(n instanceof e.FormArray)for(var a=0;a<n.controls.length;a++)n.controls[a]instanceof e.FormControl?(n.controls[a].setErrors(null,{emitEvent:!1}),n.controls[a].markAsUntouched({onlySelf:!0}),n.controls[a].markAsPristine({onlySelf:!0})):n.controls[a]instanceof r&&n.controls[a].resetValidateAllFormFields()})),this.setCustomErrors({})},r.prototype.classToClass=function(t){return o.classToClass(t,{ignoreDecorators:!0})},r.prototype.plainToClass=function(t,r){return o.plainToClass(t,r,{ignoreDecorators:!0})},r.prototype.setExternalErrorsAsync=function(t){return d(this,void 0,void 0,(function(){return p(this,(function(r){switch(r.label){case 0:this._externalErrors=t,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.validateAsync()];case 2:return[2,r.sent()];case 3:throw r.sent();case 4:return[2]}}))}))},r.prototype.setExternalErrors=function(t){this.setExternalErrorsAsync(t).then((function(){}),(function(t){throw t}))},r.prototype.getExternalErrors=function(){return this._externalErrors},r.prototype.clearExternalErrors=function(){this.setExternalErrors({})},r.prototype.clearExternalErrorsAsync=function(){return this.setExternalErrorsAsync({})},r.prototype.setValidatorOptionsAsync=function(t){return d(this,void 0,void 0,(function(){return p(this,(function(r){switch(r.label){case 0:this._validatorOptions=t,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.validateAsync()];case 2:return[2,r.sent()];case 3:throw r.sent();case 4:return[2]}}))}))},r.prototype.setValidatorOptions=function(t){this.setValidatorOptionsAsync(t).then((function(){}),(function(t){throw t}))},r.prototype.getValidatorOptions=function(){return this._validatorOptions},r.prototype.onlyFields=function(t){var o=this,n={};return void 0!==t&&Object.keys(t).forEach((function(a){t[a]instanceof r?n[a]=o.onlyFields(t[a].formFields):t[a]instanceof e.FormArray?t[a].controls[0]instanceof r?n[a]=o.onlyFields(t[a].controls[0].formFields):n[a]=t[a].controls[0].value:n[a]=t[a]})),n},r.prototype.transformValidationErrors=function(t){var r=this,e={};return t.forEach((function(t){t&&void 0!==t.constraints&&Object.keys(t.constraints).forEach((function(r){e[t.property]||(e[t.property]=[]),-1===e[t.property].indexOf(t.constraints[r])&&e[t.property].push(t.constraints[r])})),void 0!==t.children&&t.children.length&&(e[t.property]=r.transformValidationErrors(t.children))})),e},r.prototype.mergeErrors=function(t,r){var e=s(t);return l(e,r,(function(t,r){if(Array.isArray(t)&&Array.isArray(r)&&0===t.filter((function(t){return-1!==r.indexOf(t)})).length)return t.concat(r)}))},r.prototype.markAsInvalidForExternalErrors=function(t,o){o||(o=this.controls),Object.keys(o).forEach((function(n){var a=o[n];if(a instanceof e.FormControl)t&&t[n]?a.setErrors({externalError:!0}):a.errors&&!0===a.errors.externalError&&a.setErrors(null);else if(a instanceof r)a.markAsInvalidForExternalErrors(t&&t[n]?t[n]:{});else if(a instanceof e.FormArray)for(var i=0;i<a.length;i++)a[i]instanceof e.FormControl?t&&t[i]&&t[i][n]?a[i].setErrors({externalError:!0}):a[i].errors&&!0===a[i].errors.externalError&&a[i].setErrors(null):a[i]instanceof r&&a[i].markAsInvalidForExternalErrors(t&&t[i]&&t[i][n]?t[i][n]:{})}))},r.prototype.getObject=function(){var t=this,o=this._object?this.classToClass(this._object):this.factoryModel?new this.factoryModel:void 0;return void 0!==o&&Object.keys(this.controls).filter((function(t){return"foreverInvalid"!==t})).forEach((function(n){if(t.controls[n]instanceof r)o[n]=t.controls[n].object;else if(t.controls[n]instanceof e.FormArray){o[n]=[];for(var a=0;a<t.controls[n].controls.length;a++){var i=void 0;(i=t.controls[n].controls[a]instanceof r?t.controls[n].controls[a].object:t.controls[n].controls[a].value)&&Object.keys(i).length>0&&o[n].push(i)}}else o[n]=t.controls[n].value})),this.factoryModel?this.plainToClass(this.factoryModel,o):o},r.prototype.setObject=function(t){var o=this;t instanceof this.factoryModel?this._object=this.classToClass(t):this._object=this.plainToClass(this.factoryModel,t),Object.keys(this.controls).forEach((function(t){if(o.controls[t]instanceof r)o.controls[t].object=o._object?o._object[t]:{};else if(o.controls[t]instanceof e.FormArray){for(var n=o._object?o._object[t]:[],a=o.controls[t],i=a.controls[0]instanceof r,s=a.controls[0],l=a.controls[0];0!==a.length;)a.removeAt(0);for(var c=function(t){if(i){var c=new r(s.factoryModel,s.formFields);c.setParent(o);var u=E(s.factoryModel,s.formFields,void 0,o.FormControlClass),f=o._fb.group(u);Object.keys(f.controls).forEach((function(t){c.addControl(t,f.controls[t])})),c.valueChanges.subscribe((function(t){c.validate(void 0,o._validatorOptions)})),a.controls.push(c),a.controls[t].object=o._object&&n&&n[t]?n[t]:{}}else{var d=o._object&&n&&n[t]?n[t]:void 0,p=new e.FormControl(d,l.validator);p.setParent(o),a.controls.push(p)}},u=0;u<n.length;u++)c(u)}else{var f=o._object?o._object[t]:[];o.controls[t].setValue(o._object&&f?f:void 0)}})),this.objectChange.next(this._object)},r}(e.FormGroup);function E(t,r,o,a){void 0===a&&(a=g);var i=n.getFromContainer(n.MetadataStorage).getTargetValidationMetadatas(t,""),s=n.getFromContainer(n.MetadataStorage).getTargetValidationMetadatas(t,"",o&&o.groups?o.groups:void 0),l={},c=new n.Validator;return Object.keys(r).filter((function(t){return 0!==t.indexOf("__")})).forEach((function(t){var o=[];s.forEach((function(r){j(r,t,_.conditional.type)&&o.push(r)}));var c=[];i.forEach((function(r){j(r,t,_.nested.type)&&c.push(r)}));var m=[];s.forEach((function(r){j(r,t,_.nested.type)&&m.push(r)}));var g={data:l[t],validationFunctions:[],validationDefinitions:[]};void 0===g.data&&(g.data=r[t]),Array.isArray(g.data)&&g.data.length>1&&g.data.filter((function(t,r){return r>0&&"function"==typeof t})).length>0&&(g.data.filter((function(t,r){return r>0&&"function"==typeof t})).forEach((function(t){return g.validationFunctions.push(t)})),g.data=g.data[0]),s.forEach((function(e){if(e.propertyName===t&&e.type!==_.conditional.type)for(var a in e.type!==_.nested.type&&g.validationDefinitions.push(e),n.ValidationTypes)if(n.ValidationTypes.hasOwnProperty(a)){if(p(c,m,t)&&v(e,a)){var i=u(r[t]instanceof O?r[t].object:void 0,e);b(t,g,i)}if(h(e,a)){var s=d(t,e);b(t,g,s)}if(y(e,a)){var l=f(e,o,t);b(t,g,l)}}})),g.data instanceof O||g.data instanceof e.FormArray?l[t]=g.data:l[t]=new a(g)})),l;function u(t,r){return function(e){return V(0===A(e,void 0!==t?t:e.value,o).length,r,"nestedValidate")}}function f(t,r,e){return function(n){if(!n)return null;var a=!n.parent||!n.parent.value||c.validateValueByMetadata(n.value,t);!a&&r.length>0&&(a=0===F(n,e,o).filter((function(t){return t.property===e})).length);return V(a,t,"dynamicValidate")}}function d(t,r){return function(e){return V(0===function(t,r){return t.filter((function(t){return t.children.length&&t.children.filter((function(t){return t.property===r}))||t.property===r}))}(F(e,t,o),t).length,r,"customValidation")}}function p(t,o,n){return t.length===o.length||(r[n]instanceof O||r[n]instanceof e.FormArray)&&t.length>0&&0===o.length}function y(t,r){return t.type===n.ValidationTypes[r]&&void 0!==c[t.type]}function h(t,r){return m(t,r)&&t.type===_.custom.type&&r===_.custom.typeKey}function v(t,r){return m(t,r)&&t.type===_.nested.type&&r===_.nested.typeKey}function m(t,r){return t.type===n.ValidationTypes[r]&&void 0===c[t.type]}function b(t,e,o){void 0===e.data&&(e.data=r[t]),e.validationFunctions.push(o)}}function j(t,r,e){return t.propertyName===r&&t.type===e}function F(t,r,e){var o=t.parent instanceof O?t.parent.object:t.parent?t.parent.value:{};return o&&(o[r]=t.value),A(t,o,e)}function A(t,r,e){return t.parent&&t.parent.value?n.validateSync(r,e):[]}function V(t,r,e){var o;return t?null:((o={})[e]={valid:!1,type:r.type},o)}var _={nested:{type:"nestedValidation",typeKey:"NESTED_VALIDATION"},conditional:{type:"conditionalValidation"},custom:{type:"customValidation",typeKey:"CUSTOM_VALIDATION"}},C=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.FormGroupClass=O,r.FormControlClass=g,r}return u(r,t),r.prototype.group=function(r,e,o){var n=this;if(e&&(m(e)||v(e)||h(e))&&!o)return this.group(r,void 0,e);if(!e){var a=(new r).getFormFields();e=f({},a.map((function(t){var r;return(r={})[t.fieldName]="",r})).reduce((function(t,r){return f({},t,r)}),{}))}var i,s,l=o,c=null,u=null;null!=l&&(m(l)&&(c=null!=l.validators?l.validators:null,u=null!=l.asyncValidators?l.asyncValidators:null,i=null!=l.updateOn?l.updateOn:void 0),v(l)&&(c=c||[],l.validator&&c.push(l.validator),u=u||[],l.asyncValidator&&c.push(l.asyncValidator)),h(l)||(l.customValidatorOptions={validationError:{target:!1}})),void 0!==e&&(s=e),void 0===e&&(s=f({},this.createEmptyObject(r)),Object.keys(s).forEach((function(r){var e;(e=s[r])&&!Array.isArray(e)&&e.constructor&&"object"==typeof e&&(void 0===e.length||void 0!==e.length&&Object.keys(e).length===e.length)?s[r]=n.group(s[r].constructor,void 0,f({},l.customValidatorOptions?{customValidatorOptions:l.customValidatorOptions}:{},{asyncValidators:u,updateOn:i,validators:c})):function(){if(!1===Array.isArray(s[r]))return!1;var t=s[r][0];return t.constructor&&"object"==typeof t&&(void 0===t.length||void 0!==t.length&&Object.keys(t).length===t.length)}()&&(s[r][0].constructor?s[r]=t.prototype.array.call(n,s[r].map((function(t){return n.group(t.constructor,void 0,f({},l.customValidatorOptions?{customValidatorOptions:l.customValidatorOptions}:{},{asyncValidators:u,updateOn:i,validators:c}))}))):s[r]=t.prototype.array.call(n,s[r].map((function(t){return n.control(t)}))))}))),c=c&&c.filter((function(t){return t})),u=u&&u.filter((function(t){return t}));var d=E(r,s,l&&l.customValidatorOptions,this.FormControlClass),p=t.prototype.group.call(this,d,f({},u||{},i||{},c||{})),y=new O(r,s,{asyncValidators:u,updateOn:i,validators:c});return Object.keys(p.controls).forEach((function(t){y.addControl(t,p.controls[t])})),y.valueChanges.subscribe((function(){return y.validate(void 0,l&&l.customValidatorOptions)})),y},r.prototype.createEmptyObject=function(t,r){var e=this;void 0===r&&(r={});var n=!1,a=t?o.plainToClass(t,r):r;return Object.keys(a).forEach((function(t){a[t]&&void 0!==a[t].length?(1===a[t].length&&Object.keys(a[t][0]).length>0&&a[t][0].constructor&&(a[t]=[e.createEmptyObject(a[t][0].constructor)]),0===a[t].length&&(r[t]=[{}],n=!0)):r[t]=void 0})),n?this.createEmptyObject(t,r):a},r}(e.FormBuilder);t.DynamicFormBuilder=C,t.DynamicFormControl=g,t.DynamicFormGroup=O,t.FOREVER_INVALID_NAME="foreverInvalid",t.foreverInvalid=b,t.getClassValidators=E,t.isAbstractControlOptions=m,t.isDynamicFormGroupConfig=h,t.isLegacyOrOpts=v,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=libertyware-ngx-form-builder.umd.min.js.map